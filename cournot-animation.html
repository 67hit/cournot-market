<!DOCTYPE html>
<html>
<head>
<script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
<svg id="myPlot" style="width:600px;height:600px"></svg>

<script>
// M - c
const MAX = 600

// Set Dimensions
const xSize = MAX;
const ySize = MAX;
const margin = 50;
const xMax = xSize - margin*2;
const yMax = ySize - margin*2;

// Line generator, based on coordinates
const line = d3.line()
  .x(d => x(d[0]))
  .y(d => y(d[1]))

const data1 = [[0,300],[600,0]]
const data2 = [[0,600],[300,0]]

// X Axis scaling function
const x = d3.scaleLinear()
  .domain([0, xSize])
  .range([0, xMax]);

const xinv = d3.scaleLinear()
  .domain([0, xMax])
  .range([0, xSize]);


// Y Axis scaling function
const y = d3.scaleLinear()
  .domain([0, ySize])
  .range([yMax, 0]);

  const yinv = d3.scaleLinear()
  .domain([yMax, 0])
  .range([0, ySize]);

const next_point = point => [0.5*(MAX-point[1]),0.5*(MAX-point[0])];

// Append SVG Object to the Page
const svg = d3.select("#myPlot")
  .append("svg")
  .attr("id", "chart")
  .append("g")
  .attr("transform",`translate(${margin},${margin})`);

svg.append("g")
  .attr("transform", `translate(0,${yMax})`)
  .call(d3.axisBottom(x));

svg.append("g")
  .call(d3.axisLeft(y));

// Two crossing lines
svg.append("path")
    .datum(data1)
    .attr("fill", "none")
    .attr("stroke", "steelblue")
    .attr("stroke-width", 1.5)
    .attr("d", line);

svg.append("path")
    .datum(data2)
    .attr("fill", "none")
    .attr("stroke", "orange")
    .attr("stroke-width", 1.5)
    .attr("d", line);

length = (path) => d3.create("svg:path").attr("d", path).node().getTotalLength()

const drawPath = function(point) {
  var data = [];
  var cumulativeLength = [];
  for (let i = 0; i < 10; i++) {
    data.push(point);
    point = next_point(point);
    cumulativeLength.push(length(line(data)));
  }

  var l = length(line(data));

  // Draw the red path
  const path = svg.append("path")
    .datum(data)
    .attr("fill", "none")
    .attr("stroke", "red")
    .attr("stroke-width", 1)
    .attr("class", "convergence")
    .attr("stroke-dasharray", `0,${l}`)
    .attr("d", line);

  // Animate the path drawing
  path.transition()
    .duration(2000)
    .ease(d3.easeLinear)
    .attr("stroke-dasharray", `${l},${l}`);

  // Animate points appearing along the path
  const circles = svg.append('g')
    .selectAll("circle")
    .data(data)
    .enter()
    .append("circle")
    .attr("cx", d => x(d[0]))
    .attr("cy", d => y(d[1]))
    .attr("r", 0)
    .style("fill", "none")
    .style("stroke", "red")
    .attr("class", "convergence");

  circles.transition()
    .delay((d, i) => cumulativeLength[i]*1900/l) // Adjust for timing
    .duration(300)
    .attr("r", 4);
}



d3.select("#myPlot")
  .on('click', function(event)
    { var pos = d3.pointer(event,"#myPlot");
      var start = [x.invert(pos[0]-margin-8),y.invert(pos[1]-margin-8)];

      if(start[0] < 0 | start[0] > MAX | start[1] < 0 | start[1] > MAX)
      {
        return;
      }

      d3.selectAll(".convergence").remove()
      drawPath(start);
    });

</script>
</body>
</html>